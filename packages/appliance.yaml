homeassistant:
  customize:
    sensor.washing_machine_status:
      icon: mdi:washing-machine
    sensor.dishwasher_status:
      icon: mdi:dishwasher
    sensor.dryer_status:
      icon: mdi:washing-machine
    sensor.washing_machine_power:
      icon: mdi:flash
    sensor.dishwasher_power:
      icon: mdi:flash
    sensor.dryer_power:
      icon: mdi:flash 

#############################################################
#                 Input Selections 
#############################################################
input_select:
  dishwasher_status:
    name: Dishwasher Status
    options:
      - Dirty
      - Running
      - Drying
      - Clean
    initial: Dirty
  washing_machine_status:
    name: Washing Machine Status
    options:
      - Idle
      - Running
      - Finishing
      - Clean
    initial: Idle
  dryer_status:
    name: Dryer Status
    options:
      - Idle
      - Running
      - Tumbling
      - Done
    initial: Idle

#############################################################
#                 Sensors
#############################################################

sensor:
  - platform: template
    sensors:
      washing_machine_status:
        value_template: '{{ states.input_select.washing_machine_status.state}}'
        friendly_name: 'Washing Machine Status'
      washing_machine_power:
        value_template: '{{ states.switch.washing_machine.attributes.current_power_w }}'
        friendly_name: 'Washing Machine Power'
        unit_of_measurement: 'W'

      dishwasher_status:
        value_template: '{{ states.input_select.dishwasher_status.state}}'
        friendly_name: 'Dishwasher Status'
      dishwasher_power:
        value_template: '{{ states.switch.dishwasher.attributes.current_power_w }}'
        friendly_name: 'Dishwasher Power'
        unit_of_measurement: 'W'

      dryer_status:
        value_template: '{{ states.input_select.dryer_status.state}}'
        friendly_name: 'Dryer Status'
      dryer_power:
        value_template: '{{ states.switch.dryer.attributes.current_power_w }}'
        friendly_name: 'Dryer Power'
        unit_of_measurement: 'W'


#############################################################
#                 Group
#############################################################

group:
  washing_machine:
    name: Washing Machine
    entities:
      - sensor.washing_machine_status
      - switch.washing_machine
      - sensor.washing_machine_power

  dishwasher:
    name: Dishwasher
    entities:
      - sensor.dishwasher_status
      - switch.dishwasher
      - sensor.dishwasher_power

  dryer:
    name: Dryer
    entities:
      - sensor.dryer_status
      - switch.dryer
      - sensor.dryer_power

  kitchen:
    name: Appliances
    view: yes
    entities:
      - group.washing_machine
      - group.dishwasher
      - group.dryer
#############################################################
#                 Automations
#############################################################

## DISHWASHER

automation:
  - alias: "Set dishwasher active when power detected"
    trigger:
      - platform: numeric_state
        entity_id: sensor.dishwasher_power
        above: 10
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Running

  - alias: Set dishwasher drying when power drops
    trigger:
      - platform: numeric_state
        entity_id: sensor.dishwasher_power
        below: 10
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Running
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Drying

  - alias: Set dishwasher clean
    trigger:
      - platform: state
        entity_id: input_select.dishwasher_status
        to: Drying
        for:
          minutes: 40
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Drying
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Clean


## WAshing Machine

  - alias: "Set washing machine active when power detected"
    trigger:
      - platform: numeric_state
        entity_id: sensor.washing_machine_power
        above: 10
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.washing_machine_status
          option: Running


  - alias: Set washing machine finishing when power drops
    trigger:
      - platform: numeric_state
        entity_id: sensor.washing_machine_power
        below: 10
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.washing_machine_status
          state: Running
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.washing_machine_status
          option: Finishing

  - alias: Set washing machine done
    trigger:
      - platform: state
        entity_id: input_select.washing_machine_status
        to: Finishing
        for:
          minutes: 40
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.washing_machine_status
          state: Drying
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.washing_machine_status
          option: Clean



  - alias: "Set dryer active when power detected"
    trigger:
      - platform: numeric_state
        entity_id: sensor.dryer_power
        above: 10
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dryer_status
          option: Running