- id: sunset-bedroom
  alias: 'Turn Bedroom to night mode'
  trigger:
  - platform: sun
    event: sunset
    offset: '-00:30:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'off'
  action:
    service: homeassistant.turn_on
    entity_id: scene.bedtime

- id: weekday-wakeup
  alias: "Master Weekday Wakeup"
  trigger:
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.only_time.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      - condition: state
        entity_id: group.family
        state: home
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.morning

#####
# Turn Master Towel On and Off
#####
- id: towel-on
  alias: "Towel Warmer On"
  trigger:
    platform: time
    at: '06:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'off'
      - condition: state
        entity_id: group.family
        state: home
      # - condition: template
      #   value_template: "{{states.climate.master_bedroom.attributes.current_temperature|float < 67|float }}"
  action:
    service: homeassistant.turn_on
    entity_id: light.master_bath_closet_m_closet_towel_warmer

- id: towel-off
  alias: "Towel Warmer Off"
  trigger:
    platform: time
    at: '08:00:00'
  action:
    service: homeassistant.turn_off
    entity_id: light.master_bath_closet_m_closet_towel_warmer

- id: patio-open-blinds-door
  alias: "Open Blinds when patio door open"
  trigger:
    platform: state
    entity_id: binary_sensor.master_patio_door
    to: 'open'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.master_patio_blinds
        state: 'closed'
  action:
    service: cover.open_cover
    entity_id: cover.master_bed_deck_blackout